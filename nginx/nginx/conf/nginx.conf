## NGINX Server Template Start

# server {
#    listen 80;
#    listen [::]:80;

#    server_name SERVICENAME.ict-bz.ch;
#    server_tokens off;

#    location /.well-known/acme-challenge/ {
#        root /var/www/certbot;
#    }

#    location / {
#        return 301 https://SERVICENAME.ict-bz.ch$request_uri;
#    }
# }

# server {
#    listen 443 default_server ssl http2;
#    listen [::]:443 ssl http2;

#    server_name SERVICENAME.ict-bz.ch;

#    ssl_certificate /etc/nginx/ssl/live/SERVICENAME_server/fullchain.pem;
#    ssl_certificate_key /etc/nginx/ssl/live/SERVICENAME_server/privkey.pem;
   
#    location / {
#            proxy_pass       http://SERVICENAME_server;
#            proxy_redirect   off;
#            proxy_set_header Host              $http_host;
#            proxy_set_header X-Real-IP         $remote_addr;
#            proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
#            proxy_set_header X-Forwarded-Proto $scheme;
#    }
# }

# upstream SERVICENAME_server {
#    server SERVICEIP:SERVICEPORT;
# }

# NGINX Server Template End

## Moodle Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name moodle.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://moodle.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name moodle.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/moodle.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/moodle.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;
   
   location / {
           proxy_pass       http://moodle_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream moodle_server {
   server 10.10.200.111:80; #ict-edu11
}


## Owncloud Server (alte Config) -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name cloudtest.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://cloudtest.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name cloudtest.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/cloudtest.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/cloudtest.ict-bz.ch/privkey.pem;

   client_max_body_size 1000M;
   
   location / {
           proxy_pass       http://owncloud_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

#upstream owncloud_server {
#   server 10.10.200.112:80; #ict-edu12
#}

## Owncloud Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name owncloud.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://owncloud.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name owncloud.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/owncloud.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/owncloud.ict-bz.ch/privkey.pem;

   client_max_body_size 2000M;
   
   location / {
           proxy_pass       http://owncloud_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream owncloud_server {
   server 10.10.200.112:80; #ict-edu12
}

## Proxmox Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name proxmox.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://proxmox.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name proxmox.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/proxmox.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/proxmox.ict-bz.ch/privkey.pem;
   
   location / {
           proxy_pass       https://proxmox_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;

        proxy_ssl_server_name on;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
   }
}

upstream proxmox_server {
   server 10.10.100.99:8006; #devpve
}

## Ldap Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name ldap.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://ldap.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;
   
   server_name ldap.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/ldap.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/ldap.ict-bz.ch/privkey.pem;
   
   location /build/assets/ {
           proxy_pass       http://ldap_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;

           expires 1y;
           add_header Cache-Control "public, max-age=31536000, immutable";
   }

   location /dashboard {
           proxy_pass       http://ldap_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;

           expires 1y;
           add_header Cache-Control "public, max-age=31536000, immutable";
   }

   location / {
           proxy_pass       http://ldap_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;
   }
}

upstream ldap_server {
   server 10.10.200.113:8000; #ict-edu13
}



## Kurse Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name kurse.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://kurse.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name kurse.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/kurse.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/kurse.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;
   
   location / {
           proxy_pass       https://kurse_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream kurse_server {
   server 10.10.200.101:443; #ict-edu01
}


## Cloud Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name cloud.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://moodle.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name cloud.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/cloud.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/cloud.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;
   
   location / {
           proxy_pass       https://cloud_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream cloud_server {
   server 10.10.200.102:443; #ict-edu02
}


## UK Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name uk.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://uk.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name uk.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/uk.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/uk.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;
   
   location / {
           proxy_pass       https://uk_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream uk_server {
   server 10.10.200.103:443; #ict-edu03
}



## ST Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name st.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://st.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name st.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/st.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/st.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;
   
   location / {
           proxy_pass       https://st_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
   }
}

upstream st_server {
   server 10.10.200.103:443; #ict-edu03
}


## 8n8 Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name n8n.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://n8n.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name n8n.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/n8n.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/n8n.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;

   location / {
           proxy_pass       http://n8n_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;
        proxy_ssl_server_name on;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

   }
}

upstream n8n_server {
   server 10.10.200.116:5678; #ict-edu15
}

## 8n8 Server KR3 -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name n8n-kr3.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://n8n-kr3.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name n8n-kr3.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/n8n-kr3.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/n8n-kr3.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;

   location / {
           proxy_pass       http://n8n_server_kr3;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;
        proxy_ssl_server_name on;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

   }
}

upstream n8n_server_kr3 {
   server 10.10.200.116:5673; #ict-edu16
}

## 8n8 Server KR6 -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name n8n-kr6.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://n8n-kr6.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name n8n-kr6.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/n8n-kr6.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/n8n-kr6.ict-bz.ch/privkey.pem;

   client_max_body_size 512M;

   location / {
           proxy_pass       http://n8n_server_kr6;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;
        proxy_ssl_server_name on;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

   }
}

upstream n8n_server_kr6 {
   server 10.10.200.116:5676; #ict-edu16
}

## Formlog Server -------------------------------------------------------------------------------
server {
   listen 80;
   listen [::]:80;

   server_name formlog.ict-bz.ch;
   server_tokens off;

   location /.well-known/acme-challenge/ {
       root /var/www/certbot;
   }

   location / {
       return 301 https://formlog.ict-bz.ch$request_uri;
   }
}

server {
   listen 443 ssl;
   listen [::]:443 ssl;

   server_name formlog.ict-bz.ch;
   server_tokens off;

   ssl_certificate /etc/nginx/ssl/live/formlog.ict-bz.ch/fullchain.pem;
   ssl_certificate_key /etc/nginx/ssl/live/formlog.ict-bz.ch/privkey.pem;
  
   location / {
           proxy_pass       http://formlog_server;
           proxy_redirect   off;
           proxy_set_header Host              $http_host;
           proxy_set_header X-Real-IP         $remote_addr;
           proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;
           proxy_set_header X-Forwarded-Proto $scheme;
           proxy_ssl_verify off;
   }
}

upstream formlog_server {
   server 10.10.200.118:9000; #ict-edu18
}
